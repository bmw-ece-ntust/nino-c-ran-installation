@startuml
!theme plain
skinparam sequenceMessageAlign center
skinparam dpi 212

' Text color for dark backgrounds
skinparam participant {
    FontColor white
}

actor Developer
participant "<font color=white>Git Repository" as Git #111111
participant Jenkins #34a9b6
participant "<font color=white>Container Registry" as Registry #ff9800
participant Ansible #34a9b6
participant "NFO Module" as NFO #34a9b6

note over Developer : O-RAN GNB Deployment Pipeline

Developer -> Git : Commit GNB source changes
activate Git
Git -> Jenkins : Webhook trigger
activate Jenkins
Jenkins -> Git : Pull latest code
Git --> Jenkins : GNB source & manifests
deactivate Git

alt Request for Infra?
    Jenkins -> Ansible : Provision infrastructure
    activate Ansible
    
    create "Master Node" as MasterNode #8bc34a
    Ansible -> MasterNode : Deploy master_setup.sh
    activate MasterNode
    create "Kubernetes Cluster" as K8sCluster #2196f3
    MasterNode -> K8sCluster : Initialize cluster
    activate K8sCluster
    MasterNode --> Ansible : Ready
    deactivate MasterNode
    
    create "Worker Node" as WorkerNode #8bc34a
    Ansible -> WorkerNode : Deploy worker_setup.sh
    activate WorkerNode
    WorkerNode -> K8sCluster : Join cluster
    WorkerNode --> Ansible : Joined
    deactivate WorkerNode
    
    Ansible --> Jenkins : Infrastructure ready
    deactivate Ansible
end

note over Jenkins : Build Process

Jenkins -> Registry : Check current image tag
activate Registry
Registry --> Jenkins : Tag: v1.2.3
Jenkins -> Jenkins : Compare with git commit
alt New changes
    Jenkins -> Jenkins : Build GNB image
    Jenkins -> Registry : Push image v1.2.4
    Registry --> Jenkins : Pushed
else No changes
    Jenkins -> Jenkins : Use existing image
end
deactivate Registry

Jenkins -> NFO : Register cluster & deploy
activate NFO
NFO -> K8sCluster : Deploy GNB with latest image
K8sCluster -> Registry : Pull latest image
activate Registry
Registry --> K8sCluster : Image pulled
deactivate Registry
create "<font color=white>OAI GNB" as GNB #fd1234
K8sCluster -> GNB : Start GNB pods
activate GNB

participant "<font color=black>O-RU\n<font color=black>(Preconfigured)" as ORU

GNB -> ORU : Connect fronthaul
activate ORU
ORU -> GNB : Connected
deactivate ORU

GNB --> NFO : Operational
deactivate GNB
NFO --> Jenkins : Success
deactivate NFO
deactivate K8sCluster

Jenkins --> Developer : Pipeline complete
deactivate Jenkins

note over Developer, ORU : GNB â†” O-RU Active

@enduml
